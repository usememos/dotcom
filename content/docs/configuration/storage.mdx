---
title: Storage Configuration
description: Configure file storage options for attachments and media in your Memos instance.
---

Memos supports multiple storage backends for file attachments and media. Storage configuration is managed through the **web interface** in Settings → Storage (administrator access required).

## Storage Configuration Method

<Callout type="warning">
**Important**: Unlike database settings, storage options are **NOT configured via environment variables**. All storage settings are managed through the web UI in Settings → Storage.
</Callout>

## Storage Options Overview

<Cards>
  <Card title="Local Storage" href="#local-storage" icon="HardDrive">
    Store files directly on your server filesystem
  </Card>
  <Card title="S3 Compatible" href="#s3-storage" icon="Cloud">
    Use Amazon S3, MinIO, or other S3-compatible services
  </Card>
  <Card title="External Storage" href="#external-storage" icon="ExternalLink">
    Integrate with external file hosting services
  </Card>
</Cards>

## Local Storage

Local storage saves files directly to your server's filesystem. This is the default option and works well for most deployments.

### Configuration via Web UI

1. **Access Settings**: Navigate to Settings → Storage (administrator only)
2. **Select Local Storage**: Choose "Local" as your storage type
3. **Configure Path**: Set your preferred path template
4. **Save Changes**: Apply the configuration

### Default Settings

Files are stored relative to your data directory:

```bash
# Default storage location
{DATA_DIR}/assets/

# Default path template
assets/{timestamp}_{filename}
```

### Path Templates

Customize where and how files are organized using path templates with dynamic variables:

| Variable | Description | Example |
|----------|-------------|---------|
| `{year}` | Current year (4 digits) | `2025` |
| `{month}` | Current month (2 digits) | `11` |
| `{day}` | Current day (2 digits) | `23` |
| `{hour}` | Current hour (2 digits, 24h) | `14` |
| `{minute}` | Current minute (2 digits) | `30` |
| `{second}` | Current second (2 digits) | `45` |
| `{timestamp}` | Unix timestamp | `1700742000` |
| `{filename}` | Original filename | `screenshot.png` |
| `{uuid}` | Generated UUID | `a1b2c3d4-e5f6-7890` |

#### Example Path Templates

```bash
# Organize by date
assets/{year}/{month}/{day}/{timestamp}_{filename}
# Result: assets/2025/11/23/1700742000_screenshot.png

# Simple timestamped storage
files/{timestamp}_{filename}
# Result: files/1700742000_screenshot.png

# UUID-based storage (avoids filename conflicts)
uploads/{uuid}
# Result: uploads/a1b2c3d4-e5f6-7890-abcd-ef1234567890

# Organize by year and month
media/{year}-{month}/{filename}
# Result: media/2025-11/screenshot.png
```

<Callout type="tip">
**Recommended Pattern**: Use `assets/{year}/{month}/{day}/{timestamp}_{filename}` for organized, date-based storage that's easy to navigate and backup.
</Callout>

### Directory Structure

```
memos-data/
├── memos_prod.db         # Database file
└── assets/               # File storage (configurable)
    ├── 2025/
    │   ├── 11/
    │   │   ├── 23/
    │   │   │   ├── 1700742000_image.png
    │   │   │   └── 1700742001_document.pdf
    │   │   └── 24/
    │   └── 12/
    └── thumbnails/       # Generated thumbnails (if enabled)
```

### File Permissions

```bash
# Set proper permissions for file storage (Linux)
chmod 755 /path/to/memos/assets
chown -R memos:memos /path/to/memos/assets

# For Docker deployments
docker exec memos chown -R 1001:1001 /var/opt/memos/assets
```

## S3 Storage

Configure S3-compatible storage for scalable, cloud-based file storage through the web UI.

### Supported Services

- **Amazon S3**: AWS's object storage service
- **MinIO**: Self-hosted S3-compatible storage  
- **DigitalOcean Spaces**: DigitalOcean's object storage
- **Backblaze B2**: Cost-effective cloud storage
- **Cloudflare R2**: High-performance object storage
- **Any S3-compatible service**

### Configuration via Web UI

1. **Access Settings**: Navigate to Settings → Storage (administrator only)
2. **Select S3 Storage**: Choose "S3" as your storage type
3. **Configure Settings**:
   - **Endpoint**: S3 service endpoint URL
   - **Region**: S3 region (e.g., `us-east-1`)
   - **Bucket**: Bucket name
   - **Access Key**: Your access key ID
   - **Secret Key**: Your secret access key
   - **Path Prefix**: Optional path prefix within bucket
   - **URL Prefix**: Optional CDN or custom URL prefix
4. **Test Connection**: Verify settings work correctly
5. **Save Changes**: Apply the configuration

### Provider-Specific Configurations

#### Amazon S3

```
Endpoint: https://s3.amazonaws.com
Region: us-east-1
Bucket: my-memos-files
Access Key: AKIA...
Secret Key: abc123...
```

#### MinIO

```
Endpoint: https://minio.example.com
Region: us-east-1
Bucket: memos
Access Key: minio-access-key
Secret Key: minio-secret-key
Force Path Style: true
```

#### DigitalOcean Spaces

```
Endpoint: https://nyc3.digitaloceanspaces.com
Region: nyc3
Bucket: my-space-name
Access Key: do-access-key
Secret Key: do-secret-key
```

#### Cloudflare R2

```
Endpoint: https://account-id.r2.cloudflarestorage.com
Region: auto
Bucket: memos-files
Access Key: r2-access-key
Secret Key: r2-secret-key
```

### S3 Security Best Practices

#### Bucket Policy Example

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "MemosUploadAccess",
      "Effect": "Allow",
      "Principal": {
        "AWS": "arn:aws:iam::ACCOUNT:user/memos-user"
      },
      "Action": [
        "s3:PutObject",
        "s3:GetObject",
        "s3:DeleteObject"
      ],
      "Resource": "arn:aws:s3:::my-memos-bucket/memos/*"
    }
  ]
}
```

#### IAM Policy

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "s3:PutObject",
        "s3:GetObject", 
        "s3:DeleteObject",
        "s3:ListBucket"
      ],
      "Resource": [
        "arn:aws:s3:::my-memos-bucket",
        "arn:aws:s3:::my-memos-bucket/*"
      ]
    }
  ]
}
```

## External Storage

Additional storage backends can be configured through the web UI, including:

- **Database**: Store files directly in the database (not recommended for large files)
- **Custom**: Configure custom storage backends via API

## File Upload Management

File upload settings are configured through the web UI in Settings → System:

- **Maximum file size**: Set upload size limits per file
- **Allowed file types**: Configure permitted file extensions
- **Storage quota**: Set storage limits per user (if applicable)

<Callout type="info">
**Note**: File type restrictions and upload limits are managed through the web interface, not environment variables.
</Callout>

## Backup and Migration

### Backup Strategies

#### Local Storage Backup

```bash
# Simple backup
cp -r /path/to/memos/assets /backup/location/

# Compressed backup
tar -czf memos-files-$(date +%Y%m%d).tar.gz /path/to/memos/assets

# Incremental backup with rsync
rsync -av --progress /path/to/memos/assets/ /backup/location/assets/
```

#### S3 Storage Backup

```bash
# AWS CLI backup (to another bucket)
aws s3 sync s3://my-memos-bucket/memos/ s3://backup-bucket/memos/

# Download S3 files locally
aws s3 sync s3://my-memos-bucket/memos/ ./backup/files/
```

### Migration Between Storage Types

#### Local to S3 Migration

1. **Configure S3 storage** in web UI (Settings → Storage)
2. **Upload existing files** to S3:
   ```bash
   aws s3 sync /path/to/memos/assets/ s3://my-memos-bucket/memos/
   ```
3. **Update storage settings** in web UI to use S3
4. **Verify** files are accessible
5. **(Optional)** Remove local files after verification

#### S3 to Local Migration

1. **Download S3 files** to local directory:
   ```bash
   aws s3 sync s3://my-memos-bucket/memos/ /path/to/memos/assets/
   ```
2. **Configure local storage** in web UI (Settings → Storage)
3. **Verify** files are accessible
4. **(Optional)** Keep S3 as backup

## Troubleshooting

### Common Issues

#### Permission Errors (Local Storage)

```bash
# Check file permissions
ls -la /path/to/memos/assets/

# Fix permissions
chmod 755 /path/to/memos/assets/
chown -R memos:memos /path/to/memos/assets/
```

#### Storage Full (Local Storage)

```bash
# Check disk usage
df -h /path/to/memos/

# Check assets directory size
du -sh /path/to/memos/assets/

# Find large files
find /path/to/memos/assets/ -type f -size +10M -exec ls -lh {} \;
```

#### S3 Connection Issues

```bash
# Test S3 connection with AWS CLI
aws s3 ls s3://my-memos-bucket/ --endpoint-url=https://s3.amazonaws.com

# Check credentials
aws configure list

# Test bucket access
aws s3 cp test.txt s3://my-memos-bucket/test.txt
```

### Monitoring

#### Storage Usage

```bash
# Monitor local storage usage
du -sh /path/to/memos/assets/
df -h /path/to/memos/

# S3 storage monitoring
aws s3 ls s3://my-memos-bucket/memos/ --recursive --summarize
```

<Callout type="warning">
**Production Reminder**: Always test storage configuration changes in a non-production environment first, and ensure proper backups are in place.
</Callout>

## Best Practices

### Security
- **Use dedicated storage credentials** with minimal required permissions
- **Enable encryption at rest** for sensitive files (S3: server-side encryption)
- **Implement access logging** for audit trails
- **Regular security audits** of storage permissions

### Performance
- **Choose storage location** close to your users
- **Enable CDN** for frequently accessed files (S3: CloudFront)
- **Optimize file sizes** before upload
- **Monitor storage performance** metrics

### Cost Optimization
- **Implement lifecycle policies** to archive old files (S3)
- **Use appropriate storage classes** (S3: Standard, IA, Glacier)
- **Monitor storage costs** regularly
- **Clean up unused files** periodically through the web UI

## Next Steps

- [Configure database](/docs/configuration/database) for your Memos instance
- [Set up authentication](/docs/configuration/authentication) for user access
- Configure HTTPS with a reverse proxy for secure access
- Plan backup strategies for data protection

---

Need help with storage configuration? Ask in [GitHub Discussions](https://github.com/usememos/memos/discussions) or check [GitHub Issues](https://github.com/usememos/memos/issues) for troubleshooting help.